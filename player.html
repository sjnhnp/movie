<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="看看讲究将就看看">
    <title>播放器</title>

    <!-- 外部样式表 -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Vidstack Player plyr官方样式 -->
    <!--<link rel="stylesheet" href="https://cdn.vidstack.io/player.css" />
    <link rel="stylesheet" href="https://cdn.vidstack.io/plyr.css" /> -->

    <!-- Vidstack Player default官方样式 -->
    <link rel="stylesheet" href="https://cdn.vidstack.io/player/theme.css" />
    <link rel="stylesheet" href="https://cdn.vidstack.io/player/video.css" />

    <link rel="stylesheet" href="css/player_styles.css">


    <!-- 字体和图标 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- 环境变量注入 -->
    <script>window.__ENV__ = window.__ENV__ || {}; window.__ENV__.PASSWORD = "{{PASSWORD}}";</script>

    <!-- 外部库 -->
    <script src="libs/tailwindcss.min.js"></script>
    <script src="libs/sha256.min.js" defer></script>

    <!-- 主题管理脚本 -->
    <script src="js/theme.js"></script>

    <!-- 应用脚本 (defer) -->
    <script src="js/config.js" defer></script>
    <script src="js/password.js" defer></script>
    <script src="js/simple_quality_detector.js" defer></script>
    <script src="js/speed_tester.js" defer></script>
    <script src="js/api.js" defer></script>
    <script src="js/api_source_manager.js" defer></script>
    <script src="js/player_preload.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/app.js" defer></script>
</head>

<body class="page-bg text-white font-sans min-h-screen">
    <div class="player-container relative">

        <!-- 历史记录面板 -->
        <aside id="historyPanel"
            class="history-panel fixed left-0 top-0 h-full bg-black/20 backdrop-blur-xl border-r border-white/10 p-6 z-[10000] transform -translate-x-full transition-transform duration-300"
            aria-label="观看历史" tabindex="-1">
            <div class="flex justify-between items-center mb-8">
                <button id="closeHistoryPanelButton"
                    class="text-white/60 hover:text-white bg-white/10 hover:bg-white/20 rounded-xl p-2 transition-all duration-300"
                    aria-label="关闭历史" type="button">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
                <h3 class="text-2xl font-bold gradient-text mx-auto">观看历史</h3>
                <div class="w-9"></div>
            </div>
            <div id="historyList" class="pb-4" role="region" aria-live="polite">
                <div class="text-center text-white/60 py-12">
                    <svg class="w-16 h-16 mx-auto mb-4 text-white/30" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-lg font-medium">暂无观看记录</p>
                    <p class="text-sm text-white/40 mt-2">开始观看视频后，历史记录会显示在这里</p>
                </div>
            </div>
            <div class="mt-4 text-center sticky bottom-0 pb-2 pt-2">
                <button onclick="clearViewingHistory()" class="clear-history-btn w-full transition-all duration-300"
                    type="button">
                    清空历史记录
                </button>
            </div>
        </aside>

        <!-- 搜索面板 -->
        <div id="searchPanel"
            class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center transition-opacity duration-300 z-[10001]"
            role="dialog" aria-modal="true" aria-labelledby="searchPanelTitle" aria-hidden="true" tabindex="-1">
            <div
                class="bg-black/20 backdrop-blur-xl border border-white/10 p-6 rounded-2xl w-11/12 max-w-6xl max-h-[90vh] flex flex-col shadow-2xl">

                <!-- 顶部区域：搜索框和关闭按钮 -->
                <div class="flex-none mb-4">
                    <div class="flex items-center gap-4">
                        <!-- 搜索框 -->
                        <div class="flex-1">
                            <form id="searchForm">
                                <div class="relative group">
                                    <div class="absolute -inset-1.5 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full blur-xl opacity-30 group-hover:opacity-60 transition-all duration-500"
                                        aria-hidden="true">
                                    </div>

                                    <div
                                        class="relative flex items-stretch h-14 bg-black/40 backdrop-blur-md border border-white/10 rounded-full overflow-hidden shadow-2xl">
                                        <input type="text" id="searchInput"
                                            class="flex-1 bg-transparent text-white pl-7 pr-4 py-0 focus:outline-none placeholder-white/50 text-lg"
                                            placeholder="搜索你想看的..." autocomplete="off" aria-label="视频搜索框">

                                        <button type="submit"
                                            class="w-14 flex-shrink-0 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 transition-all duration-300"
                                            aria-label="搜索按钮">
                                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- 关闭按钮 -->
                        <button id="closeSearchPanelButton"
                            class="text-white/60 hover:text-white bg-white/10 hover:bg-white/20 rounded-xl p-2 transition-all duration-300 flex-shrink-0"
                            aria-label="关闭搜索" type="button">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- 搜索历史区域：标签和历史记录在一行 -->
                <div class="flex-none mb-4">
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between items-center">
                            <span class="text-white/70 text-sm font-medium whitespace-nowrap">最近搜索：</span>
                            <button id="clearSearchHistory"
                                class="text-white/50 hover:text-white/80 text-xs whitespace-nowrap transition-colors"
                                title="清除搜索历史">
                                清除搜索历史
                            </button>
                        </div>
                        <div id="recentSearches" class="flex flex-wrap gap-2" aria-label="最近搜索记录" aria-live="polite">
                        </div>
                    </div>
                </div>

                <!-- 搜索结果区域 -->
                <div class="overflow-auto flex-1 min-h-0 bg-white/5 rounded-xl p-6">
                    <div id="searchFeedbackArea" class="w-full text-center mb-4 hidden">
                    </div>

                    <div id="searchResultsArea" class="w-full hidden" aria-label="搜索结果">
                        <div class="flex justify-end items-center mb-4">
                            <div class="text-sm text-gray-400">
                                <span id="searchResultsCount">0</span> 个结果
                            </div>
                        </div>
                        <div id="searchResults" role="region" aria-live="polite">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 顶部导航栏 -->
        <header class="flex items-center justify-between p-6">
            <div class="flex items-center gap-3">
                <button id="back-button"
                    class="flex items-center sm:gap-3 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl sm:px-4 px-2.5 py-2.5 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
                    aria-label="返回">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        aria-hidden="true">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    <span class="hidden sm:inline font-medium">返回</span>
                </button>

                <button id="historyButton"
                    class="flex items-center sm:gap-3 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl sm:px-4 px-2.5 py-2.5 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
                    aria-label="观看历史" type="button">
                    <svg class="w-5 h-5" fill="none" stroke="#ffffff" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="hidden sm:inline font-medium">历史</span>
                </button>

                <button id="searchButton"
                    class="flex items-center sm:gap-3 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl sm:px-4 px-2.5 py-2.5 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
                    aria-label="搜索视频" type="button">
                    <svg class="w-5 h-5" fill="none" stroke="#ffffff" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <span class="hidden sm:inline font-medium">搜索</span>
                </button>
            </div>

            <div class="flex items-center ml-auto gap-3">
                <!-- 主题切换按钮 -->
                <button id="themeToggleButton"
                    class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
                    aria-label="切换主题" type="button" title="切换日间/夜间模式">
                    <svg id="themeIcon" class="w-5 h-5" fill="none" stroke="#ffffff" viewBox="0 0 24 24" aria-hidden="true">
                        <!-- 默认显示太阳图标（当前是夜间模式） -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                    </svg>
                </button>

                <button id="fullscreen-button"
                    class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white allow-when-locked transition-all duration-300 shadow-lg hover:shadow-xl"
                    aria-label="全屏">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="feather feather-maximize" aria-hidden="true">
                        <path
                            d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
                        </path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- 播放器区域 -->
        <div id="player-region" class="relative" role="region" aria-label="视频播放区域">
            <!-- Vidstack 播放器 -->
            <media-player id="player" class="w-full h-full" crossOrigin key-target="document" playsinline autoplay>
                <media-provider></media-provider>
                <!-- 使用默认布局，但不添加自定义按钮到 slot -->
                <media-video-layout></media-video-layout>
            </media-player>

            <!-- 自定义右侧控制条 - 覆盖在播放器上 -->
            <div id="custom-right-controls"
                class="absolute flex flex-col gap-2 z-50 opacity-0 transition-opacity duration-300">
                <button id="web-fullscreen-control-btn"
                    class="bg-black/50 hover:bg-black/70 backdrop-blur-sm border border-white/20 hover:border-white/40 rounded-lg p-2 text-white/90 hover:text-white transition-all duration-300 shadow-lg"
                    title="网页全屏 (W)" aria-label="网页全屏">
                    <svg class="w-5 h-5" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M17.3183 12.4856L21.2231 8.58073C21.3071 8.49674 21.2476 8.35312 21.1288 8.35312H18.0189C17.6507 8.35312 17.3522 8.05464 17.3522 7.68645V5.95312C17.3522 5.58493 17.6507 5.28645 18.0189 5.28645H26.0189C26.387 5.28645 26.6862 5.58493 26.6862 5.95312V13.9531C26.6862 14.3213 26.3877 14.6198 26.0196 14.6198H24.2862C23.918 14.6198 23.6196 14.3213 23.6196 13.9531V10.8431C23.6196 10.7243 23.4759 10.6648 23.3919 10.7488L19.4867 14.6541C19.2264 14.9144 18.8043 14.9144 18.5439 14.6541L17.3183 13.4284C17.0579 13.1681 17.0579 12.7459 17.3183 12.4856Z"
                            fill="currentColor" />
                        <path
                            d="M6.1153 26.7135H14.1153C14.4835 26.7135 14.782 26.4151 14.782 26.0469V24.3135C14.782 23.9453 14.4835 23.6469 14.1153 23.6469H11.0053C10.8865 23.6469 10.827 23.5033 10.911 23.4193L14.8159 19.5144C15.0763 19.254 15.0763 18.8319 14.8159 18.5716L13.5903 17.3459C13.3299 17.0856 12.9078 17.0856 12.6474 17.3459L8.74222 21.2512C8.65822 21.3351 8.5146 21.2757 8.5146 21.1569L8.51461 18.0469C8.51461 17.6787 8.21613 17.3802 7.84794 17.3802H6.11461C5.74642 17.3802 5.44794 17.6787 5.44794 18.0469V26.0469C5.44794 26.4151 5.74711 26.7135 6.1153 26.7135Z"
                            fill="currentColor" />
                    </svg>
                </button>
            </div>

            <!-- 加载和错误覆盖层 (保持不变) -->
            <div id="loading" class="loading-container hidden" aria-live="polite">
                <div class="loading-spinner" aria-hidden="true"></div>
                <div class="mt-4">加载中...</div>
            </div>
            <div id="error" class="error-container" aria-live="assertive">
                <div class="error-icon" aria-hidden="true">⚠️</div>
                <div class="text-xl font-bold">播放出错</div>
                <div class="mt-2">请尝试其他线路或刷新页面</div>
                <button id="retry-button"
                    class="mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors">重试</button>
            </div>

            <div id="toast"
                class="fixed top-4 left-1/2 -translate-x-1/2 opacity-0 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 text-white z-[10001] pointer-events-none">
                <span id="toastMessage"></span>
            </div>
        </div>

        <!-- 播放控制和剧集信息 -->
        <div class="flex items-center justify-between p-6">
            <button id="prev-episode"
                class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-5 py-3 text-white/90 hover:text-white flex items-center gap-3 transition-all duration-300 shadow-lg hover:shadow-xl font-medium"
                aria-label="上一集">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-skip-back">
                    <polygon points="19 20 9 12 19 4 19 20"></polygon>
                    <line x1="5" y1="19" x2="5" y2="5"></line>
                </svg>
                <span>上一集</span>
            </button>
            <span id="episode-info-span"
                class="text-xl font-semibold text-white/90 bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl px-4 py-2 hidden"></span>
            <button id="next-episode"
                class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-5 py-3 text-white/90 hover:text-white flex items-center gap-3 transition-all duration-300 shadow-lg hover:shadow-xl font-medium"
                aria-label="下一集">
                <span>下一集</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-skip-forward">
                    <polygon points="5 4 15 12 5 20 5 4"></polygon>
                    <line x1="19" y1="5" x2="19" y2="19"></line>
                </svg>
            </button>
        </div>

        <!-- 功能控制条 -->
        <div class="p-6 bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl mx-6 mb-6 shadow-xl">
            <!-- 新增控制按钮容器 -->
            <div class="player-control-bar-wrapper">
                <div class="player-control-bar">
                    <!-- 合并的播放设置按钮 -->
                    <div class="control-btn-container play-settings-container">
                        <button id="play-settings-button" title="播放设置"
                            class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium"
                            aria-label="播放设置">
                            <svg xmlns="http://www.w3.org/2000/svg" class="control-icon" fill="none" viewBox="0 0 24 24"
                                stroke="#ffffff">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4" />
                            </svg>
                            <span class="control-text text-sm">设置</span>
                        </button>
                        <div id="play-settings-dropdown"
                            class="hidden absolute right-0 bottom-full mb-2 bg-white/5 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-56">
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-white/90 text-sm font-medium">自动连播</span>
                                <label class="switch">
                                    <input type="checkbox" id="autoplay-next" checked aria-label="自动播放">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-white/90 text-sm font-medium">记住进度</span>
                                <label class="switch">
                                    <input type="checkbox" id="remember-episode-progress-toggle" checked
                                        aria-label="记住进度">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-white/90 text-sm font-medium">广告过滤</span>
                                <label class="switch">
                                    <input type="checkbox" id="adFilterToggle" aria-label="分片广告过滤">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="flex items-center justify-between mb-3">
                                <span class="text-white/90 text-sm font-medium">预加载</span>
                                <div class="flex items-center gap-3">
                                    <label class="switch">
                                        <input type="checkbox" id="preloadingToggle" aria-label="播放预加载">
                                        <span class="slider"></span>
                                    </label>
                                    <input type="number" min="1" max="10" step="1" id="preloadCountInput"
                                        class="w-16 bg-white/10 border border-white/20 text-white px-2 py-1 rounded-lg text-sm text-center focus:outline-none focus:border-white/40 transition-all duration-300"
                                        title="预加载范围1-10" aria-label="预加载集数">
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-white/90 text-sm font-medium">播放速率</span>
                                <select id="playback-speed-select"
                                    class="bg-white/10 text-white/90 rounded-lg px-2 py-1 text-sm border border-white/20 focus:border-white/40 focus:outline-none">
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2x</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 线路切换按钮 -->
                    <div class="control-btn-container line-switch-container">
                        <button id="line-switch-button"
                            class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" class="control-icon" fill="none" viewBox="0 0 24 24"
                                stroke="#ffffff">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                            </svg>
                            <span class="control-text text-sm">线路</span>
                        </button>
                        <div id="line-switch-dropdown" class="hidden"></div>
                    </div>

                    <!-- 跳过控制按钮 -->
                    <div class="control-btn-container skip-control-container">
                        <button id="skip-control-button" title="跳过设置"
                            class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300">
                            <svg xmlns="http://www.w3.org/2000/svg" class="control-icon" fill="none" viewBox="0 0 24 24"
                                stroke="#ffffff">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7M15 5l7 7-7 7" />
                            </svg>
                            <span class="control-text text-sm">跳过</span>
                        </button>
                        <div id="skip-control-dropdown"
                            class="hidden absolute right-0 bottom-full mb-2 bg-white/5 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-52">
                            <div class="flex items-center mb-3">
                                <label for="skip-intro-input"
                                    class="text-white/90 text-sm mr-3 shrink-0 font-medium">跳片头</label>
                                <input id="skip-intro-input" type="number" min="0" step="1" placeholder="秒"
                                    class="w-full bg-white/10 text-white/90 rounded-lg p-2 text-sm border border-white/20 focus:border-white/40 focus:outline-none">
                            </div>
                            <div class="flex items-center mb-4">
                                <label for="skip-outro-input"
                                    class="text-white/90 text-sm mr-3 shrink-0 font-medium">跳片尾</label>
                                <input id="skip-outro-input" type="number" min="0" step="1" placeholder="秒"
                                    class="w-full bg-white/10 text-white/90 rounded-lg p-2 text-sm border border-white/20 focus:border-white/40 focus:outline-none">
                            </div>
                            <button id="apply-skip-settings"
                                class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white rounded-lg p-2 mb-2 text-sm font-medium transition-all duration-300">应用</button>
                            <button id="reset-skip-settings"
                                class="w-full bg-white/10 hover:bg-white/20 text-white/90 hover:text-white rounded-lg p-2 text-sm font-medium transition-all duration-300 border border-white/20">重置</button>
                        </div>
                    </div>

                    <!-- 复制链接按钮 -->
                    <div class="control-btn-container">
                        <button onclick="copyLinks()" title="复制当前视频链接"
                            class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300"
                            aria-label="复制链接">
                            <svg xmlns="http://www.w3.org/2000/svg" class="control-icon" fill="none" viewBox="0 0 24 24"
                                stroke="#ffffff">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            <span class="control-text text-sm">复制</span>
                        </button>
                    </div>

                    <!-- 剧集顺序按钮 -->
                    <div class="control-btn-container">
                        <button id="order-button"
                            class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300"
                            aria-label="切换剧集顺序">
                            <svg id="order-icon" xmlns="http://www.w3.org/2000/svg" class="control-icon"
                                viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" style="transition: transform 0.3s ease;">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                            <span class="control-text text-sm">顺序</span>
                        </button>
                    </div>

                    <!-- 锁屏按钮 -->
                    <div class="control-btn-container">
                        <button id="lock-button"
                            class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300"
                            aria-label="锁定/解锁屏幕控制">
                            <svg id="lock-icon" xmlns="http://www.w3.org/2000/svg" class="control-icon"
                                viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            <span class="control-text text-sm">锁屏</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 剧集选择 -->
        <div id="episodes-container" class="mt-2 mx-6 mb-6 hidden" role="navigation" aria-label="剧集选择">
            <div class="bg-white/5 backdrop-blur-md border border-white/10 rounded-2xl p-6 shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-white/90">选集</h2>
                    <span id="episodes-count"
                        class="text-white/60 bg-white/10 px-3 py-1 rounded-lg text-sm font-medium"></span>
                </div>
                <div id="episode-grid"
                    class="grid grid-cols-4 sm:grid-cols-6 md:grid-cols-8 lg:grid-cols-10 gap-3 max-h-80 overflow-y-auto">
                </div>
            </div>
        </div>

        <!-- 快捷键和消息提示 -->
        <div id="shortcut-hint" class="shortcut-hint" aria-live="polite" aria-atomic="true">
            <span id="shortcut-key"></span>
            <span id="shortcut-action"></span>
        </div>
        <div id="message" class="fixed top-4 right-4 p-4 rounded shadow-lg z-50 hidden" aria-live="polite"></div>

        <!-- 详情模态框 -->
        <div id="modal"
            class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center transition-opacity duration-300 z-[10002]"
            role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true" tabindex="-1">
            <div
                class="bg-black/20 backdrop-blur-xl border border-white/10 p-8 rounded-2xl w-11/12 max-w-4xl max-h-[90vh] flex flex-col shadow-2xl">
                <div class="flex justify-between items-center mb-8 flex-none">
                    <h2 id="modalTitle" class="text-3xl font-bold gradient-text break-words pr-4 max-w-[80%]"></h2>
                    <button id="closeModalButton"
                        class="text-white/60 hover:text-white bg-white/10 hover:bg-white/20 rounded-xl p-2 transition-all duration-300 flex-shrink-0"
                        aria-label="关闭详情" type="button">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12">
                            </path>
                        </svg>
                    </button>
                </div>
                <div id="modalContent" class="overflow-auto flex-1 min-h-0 bg-white/5 rounded-xl p-6">
                </div>
            </div>
        </div>

        <!-- 加载提示 -->
        <div id="loading"
            class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-[10003]">
            <div class="bg-black/20 backdrop-blur-xl border border-white/10 p-8 rounded-2xl text-center">
                <div class="loading-spinner mb-4"></div>
                <p class="text-white text-lg">加载中...</p>
            </div>
        </div>

        <!-- Toast 消息 -->
        <div id="toast"
            class="fixed top-4 left-1/2 -translate-x-1/2 opacity-0 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 text-white z-[10004] pointer-events-none">
            <span id="toastMessage"></span>
        </div>

        <!-- 记住进度弹窗 -->
        <div id="progress-restore-modal" tabindex="-1" aria-modal="true" role="dialog" style="display: none;">
            <div class="progress-restore-card" role="document">
                <div class="progress-modal-title">继续播放？</div>
                <div class="progress-modal-content"><!-- JS填充 --></div>
                <div class="progress-modal-actions">
                    <button class="progress-modal-btn cancel" id="progress-restore-cancel">取消</button>
                    <button class="progress-modal-btn confirm" id="progress-restore-confirm">确定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Templates -->
    <template id="search-result-template">
        <div class="card-hover bg-[#111] rounded-lg overflow-hidden cursor-pointer transition-all hover:scale-[1.02] h-full shadow-sm hover:shadow-md"
            data-id="" data-source-code="">
            <div class="flex h-full">
                <div class="search-card-img-container relative flex-shrink-0">
                    <img src="https://via.placeholder.com/100x150/191919/555555?text=No+Image" alt="视频封面"
                        class="result-img h-full w-full object-cover transition-transform hover:scale-110"
                        loading="lazy" data-field="pic"
                        onerror="this.onerror=null; this.src='https://via.placeholder.com/100x150/191919/555555?text=Error'; this.classList.add('object-contain');">
                    <div class="absolute inset-0 bg-gradient-to-r from-black/30 to-transparent"></div>
                </div>
                <div class="p-2 flex flex-col flex-grow">
                    <div class="flex-grow">
                        <h3 class="result-title font-semibold text-sm mb-1 break-words line-clamp-2" data-field="title"
                            title="视频标题">视频标题
                        </h3>
                        <div class="result-meta flex flex-wrap items-center gap-x-2 gap-y-0.5 mb-1">
                            <span
                                class="result-type hidden text-xs py-0.5 px-1.5 rounded bg-opacity-20 bg-blue-500 text-blue-300"
                                data-field="type">类型</span>
                            <span
                                class="result-year hidden text-xs py-0.5 px-1.5 rounded bg-opacity-20 bg-purple-500 text-purple-300"
                                data-field="year">年份</span>
                            <span data-field="speed-tag"
                                class="hidden text-xs py-0.5 px-1.5 rounded bg-opacity-20 bg-green-500 text-green-300"></span>
                        </div>
                        <p class="result-remarks hidden text-xs text-gray-400 mb-1 line-clamp-1" data-field="remarks">
                            更新状态</p>
                    </div>
                    <div class="result-source flex justify-between items-center mt-auto pt-1 border-t border-gray-800">
                        <span class="result-source-name text-xs text-gray-500" data-field="source">数据源</span>
                        <span
                            class="quality-tag text-xs font-medium py-0.5 px-1.5 rounded bg-gray-500 text-white cursor-pointer transition-colors hover:opacity-80"
                            data-field="quality-tag" data-action="retest-quality" title="点击重新检测画质">
                            检测中...
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="video-details-template">
        <div class="text-white text-sm">
            <div class="grid grid-cols-2 gap-x-4 gap-y-2 mb-4">
                <div><span class="text-gray-400">类型:</span> <span data-field="type"></span></div>
                <div><span class="text-gray-400">年份:</span> <span data-field="year"></span></div>
                <div><span class="text-gray-400">地区:</span> <span data-field="area"></span></div>
                <div><span class="text-gray-400">语言:</span> <span data-field="lang"></span></div>
                <div><span class="text-gray-400">导演:</span> <span data-field="director"></span></div>
                <div><span class="text-gray-400">主演:</span> <span data-field="actor"></span></div>
                <div class="col-span-2"><span class="text-gray-400">来源:</span> <span data-field="source"
                        class="text-blue-400"></span></div>
            </div>
            <div class="mb-4">
                <div class="text-gray-400 mb-2">剧情简介:</div>
                <p class="text-gray-300 leading-relaxed" data-field="content"></p>
            </div>
            <div data-field="episodesContainer">
                <div class="mb-4 flex justify-between items-center">
                    <div class="flex items-center space-x-2">
                        <div class="text-sm text-gray-400">共 <span data-field="episode-count">0</span> 集</div>
                        <span class="px-2 py-0.5 bg-gray-700 text-white text-xs rounded"
                            data-field="quality-tag">检测中...</span>
                        <!-- 加载速度显示位置 -->
                        <span class="px-2 py-0.5 bg-gray-700 text-white text-xs rounded hidden"
                            data-field="speed-tag"></span>
                    </div>
                    <!-- 播放页暂时隐藏这些功能按钮 -->
                    <div class="flex items-center space-x-2" style="display: none;">
                        <button data-action="copy-links" title="复制所有剧集链接"
                            class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                        </button>
                        <button data-action="toggle-order" title="切换为倒序排列"
                            class="p-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors flex items-center justify-center">
                            <svg data-field="order-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor" style="transition: transform 0.3s ease;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div data-field="episode-buttons-grid"
                    class="grid grid-cols-3 xs:grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-2">
                </div>
            </div>
        </div>
    </template>

    <!-- 启动脚本 -->
    <script src="js/utils.js" defer></script>
    <script src="js/player_search_history.js" defer></script>
    <script type="module" src="./js/player_app.js"></script>
</body>

</html>