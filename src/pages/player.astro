---
import '../styles/global.css';

import { createHash } from 'crypto';
const password = import.meta.env.PASSWORD || '';
const settingsPassword = import.meta.env.SETTINGS_PASSWORD || '';

const sha256 = (str: string) => createHash('sha256').update(str).digest('hex');
const passwordHash = password ? sha256(password) : '';
const settingsPasswordHash = settingsPassword ? sha256(settingsPassword) : '';

const userAgent = Astro.request.headers.get('user-agent') || '';
const isMobile = /Mobile|Android|iPhone|iPad|iPod|Windows Phone/i.test(userAgent);

const currentUrl = Astro.url.toString();
const path = Astro.url.pathname;

if (path === '/player' || path === '/player/') {
  if (isMobile) {
    const searchParams = Astro.url.search;
    return Astro.redirect(`/player-mobile${searchParams}`);
  }
} else if (path === '/player-mobile' || path === '/player-mobile/') {
  if (!isMobile) {
    const searchParams = Astro.url.search;
    return Astro.redirect(`/player${searchParams}`);
  }
}
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="看看讲究将就看看" />
    <title>播放器</title>
  </head>
  <body>
    <script>
      (function() {
        const isMobile = /Mobile|Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent);
        const currentPath = window.location.pathname;
        const searchParams = window.location.search;
        
        if (currentPath === '/player' || currentPath === '/player/') {
          if (isMobile) {
            window.location.href = '/player-mobile' + searchParams;
          } else {
            window.location.href = '/player-desktop' + searchParams;
          }
        } else if (currentPath === '/player-mobile' || currentPath === '/player-mobile/') {
          if (!isMobile) {
            window.location.href = '/player-desktop' + searchParams;
          }
        }
      })();
    </script>
  </body>
</html>
