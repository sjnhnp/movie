---
import '../styles/global.css';
import '../styles/player_styles_mobile.css';

import { createHash } from 'crypto';
const password = import.meta.env.PASSWORD || '';
const settingsPassword = import.meta.env.SETTINGS_PASSWORD || '';

const sha256 = (str: string) => createHash('sha256').update(str).digest('hex');
const passwordHash = password ? sha256(password) : '';
const settingsPasswordHash = settingsPassword ? sha256(settingsPassword) : '';
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="看看讲究将就看看" />
    <title>播放器</title>

    <link rel="stylesheet" href="https://cdn.vidstack.io/player/theme.css" />
    <link rel="stylesheet" href="https://cdn.vidstack.io/player/video.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"
      rel="stylesheet"
    />

    <script is:inline src="/libs/sha256.min.js" defer></script>
    <script is:inline src="/js/config.js" defer></script>
    <script is:inline src="/js/utils.js" defer></script>
    <script is:inline define:vars={{ passwordHash, settingsPasswordHash }}>
      window.__ENV__ = window.__ENV__ || {};
      window.__ENV__.PASSWORD = passwordHash;
      window.__ENV__.SETTINGS_PASSWORD = settingsPasswordHash;
    </script>
    <script is:inline src="/js/password.js" defer></script>
    <script is:inline src="/js/simple_quality_detector.js" defer></script>
    <script is:inline src="/js/speed_tester.js" defer></script>
    <script is:inline src="/js/ui.js" defer></script>
    <script is:inline src="/js/api.js" defer></script>
    <script is:inline src="/js/api_source_manager.js" defer></script>
    <script is:inline src="/js/player_preload.js" defer></script>
  </head>
  <body class="page-bg text-white font-sans min-h-screen">
    <div class="player-container relative">
      <aside
        id="historyPanel"
        class="history-panel p-6"
        aria-label="观看历史"
        aria-hidden="true"
        tabindex="-1"
      >
        <div class="flex justify-between items-center mb-8">
          <h3 class="text-2xl font-bold gradient-text">观看历史</h3>
          <button
            id="closeHistoryPanelButton"
            class="text-white/60 hover:text-white bg-white/10 hover:bg-white/20 rounded-xl p-2 transition-all duration-300"
            aria-label="关闭历史"
            type="button"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              >
              </path>
            </svg>
          </button>
        </div>
        <div id="historyList" class="pb-4" role="region" aria-live="polite">
          <div class="text-center text-white/60 py-12">
            <svg
              class="w-16 h-16 mx-auto mb-4 text-white/30"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <p class="text-lg font-medium">暂无观看记录</p>
            <p class="text-sm text-white/40 mt-2">开始观看视频后，历史记录会显示在这里</p>
          </div>
        </div>
        <div class="mt-4 text-center sticky bottom-0 pb-2 pt-2">
          <button
            onclick="clearViewingHistory()"
            class="clear-history-btn w-full transition-all duration-300"
            type="button"
          >
            清空历史记录
          </button>
        </div>
      </aside>

      <div
        id="searchPanel"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center transition-opacity duration-300 z-10001"
        role="dialog"
        aria-modal="true"
        aria-labelledby="searchPanelTitle"
        aria-hidden="true"
        tabindex="-1"
      >
        <div
          class="bg-black/20 backdrop-blur-xl border border-white/10 p-6 rounded-2xl w-[95%] max-w-5xl max-h-[90vh] flex flex-col shadow-2xl"
        >
          <div class="flex-none mb-4">
            <div class="flex items-center gap-4 relative">
              <div class="flex-1 pr-12">
                <form id="searchForm">
                  <div class="relative group">
                    <div
                      class="absolute -inset-1.5 bg-linear-to-r from-indigo-500 to-purple-600 rounded-full blur-xl opacity-30 group-hover:opacity-60 transition-all duration-500"
                      aria-hidden="true"
                    >
                    </div>

                    <div
                      class="relative flex items-stretch h-14 bg-black/40 backdrop-blur-md border border-white/10 rounded-full overflow-hidden shadow-2xl"
                    >
                      <input
                        type="text"
                        id="searchInput"
                        class="flex-1 bg-transparent text-white pl-7 pr-4 py-0 focus:outline-none placeholder-white/50 text-lg"
                        placeholder="搜索你想看的..."
                        autocomplete="off"
                        aria-label="视频搜索框"
                      />

                      <button
                        type="submit"
                        class="w-14 shrink-0 flex items-center justify-center text-white/70 hover:text-white hover:bg-white/10 transition-all duration-300"
                        aria-label="搜索按钮"
                      >
                        <svg
                          class="w-6 h-6"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                </form>
              </div>

              <button
                id="closeSearchPanelButton"
                class="text-white/60 hover:text-white bg-white/10 hover:bg-white/20 rounded-xl p-2 transition-all duration-300 shrink-0 absolute right-0"
                aria-label="关闭搜索"
                type="button"
              >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </div>

          <div class="flex-none mb-4">
            <div class="flex flex-col gap-2">
              <div class="flex justify-between items-center">
                <span class="text-white/70 text-sm font-medium whitespace-nowrap">最近搜索：</span>
                <button
                  id="clearSearchHistory"
                  class="text-white/50 hover:text-white/80 text-xs whitespace-nowrap transition-colors"
                  title="清除搜索历史"
                >
                  清除搜索历史
                </button>
              </div>
              <div
                id="recentSearches"
                class="flex flex-wrap gap-2"
                aria-label="最近搜索记录"
                aria-live="polite"
              >
              </div>
            </div>
          </div>

          <div class="overflow-auto flex-1 min-h-0 bg-white/5 rounded-xl p-6">
            <div id="searchFeedbackArea" class="w-full text-center mb-4 hidden"></div>

            <div id="searchResultsArea" class="w-full hidden" aria-label="搜索结果">
              <div class="flex justify-end items-center mb-4">
                <div class="text-sm text-gray-400">
                  <span id="searchResultsCount">0</span> 个结果
                </div>
              </div>
              <div id="searchResults" role="region" aria-live="polite"></div>
            </div>
          </div>
        </div>
      </div>

      <header
        class="flex items-center justify-between p-4 md:p-6 bg-transparent sticky top-0 z-1000 pointer-events-none mb-2 md:mb-4"
      >
        <div class="flex items-center gap-3 md:gap-4 pointer-events-auto">
          <button
            id="back-button"
            class="flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-3 py-2 md:px-4 md:py-2.5 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl group"
            aria-label="返回"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 group-hover:-translate-x-1 transition-transform"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="19" y1="12" x2="5" y2="12"></line>
              <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            <span class="hidden sm:inline font-medium">返回</span>
          </button>

          <button
            id="historyButton"
            class="flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-3 py-2 md:px-4 md:py-2.5 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
            aria-label="观看历史"
            type="button"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span class="hidden sm:inline font-medium">历史</span>
          </button>

          <button
            id="searchButton"
            class="flex items-center gap-2 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-3 py-2 md:px-4 md:py-2.5 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
            aria-label="搜索视频"
            type="button"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="hidden sm:inline font-medium">搜索</span>
          </button>
        </div>

        <div class="flex items-center pointer-events-auto">
          <button
            id="fullscreen-button"
            class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-2.5 md:p-3 text-white/90 hover:text-white transition-all duration-300 shadow-lg hover:shadow-xl"
            aria-label="全屏"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
              ></path>
            </svg>
          </button>
        </div>
      </header>

      <div id="player-region" class="relative" role="region" aria-label="视频播放区域">
        <media-player
          id="player"
          class="w-full h-full"
          crossOrigin
          key-target="document"
          playsinline
          autoplay
        >
          <media-provider></media-provider>
          <media-video-layout></media-video-layout>
        </media-player>

        <div
          id="custom-right-controls"
          class="absolute flex flex-col gap-2 z-50 opacity-0 transition-opacity duration-300"
        >
          <button
            id="web-fullscreen-control-btn"
            class="bg-black/50 hover:bg-black/70 backdrop-blur-sm border border-white/20 hover:border-white/40 rounded-lg p-2 text-white/90 hover:text-white transition-all duration-300 shadow-lg"
            title="网页全屏 (W)"
            aria-label="网页全屏"
          >
            <svg class="w-5 h-5" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M17.3183 12.4856L21.2231 8.58073C21.3071 8.49674 21.2476 8.35312 21.1288 8.35312H18.0189C17.6507 8.35312 17.3522 8.05464 17.3522 7.68645V5.95312C17.3522 5.58493 17.6507 5.28645 18.0189 5.28645H26.0189C26.387 5.28645 26.6862 5.58493 26.6862 5.95312V13.9531C26.6862 14.3213 26.3877 14.6198 26.0196 14.6198H24.2862C23.918 14.6198 23.6196 14.3213 23.6196 13.9531V10.8431C23.6196 10.7243 23.4759 10.6648 23.3919 10.7488L19.4867 14.6541C19.2264 14.9144 18.8043 14.9144 18.5439 14.6541L17.3183 13.4284C17.0579 13.1681 17.0579 12.7459 17.3183 12.4856Z"
                fill="currentColor"></path>
              <path
                d="M6.1153 26.7135H14.1153C14.4835 26.7135 14.782 26.4151 14.782 26.0469V24.3135C14.782 23.9453 14.4835 23.6469 14.1153 23.6469H11.0053C10.8865 23.6469 10.827 23.5033 10.911 23.4193L14.8159 19.5144C15.0763 19.254 15.0763 18.8319 14.8159 18.5716L13.5903 17.3459C13.3299 17.0856 12.9078 17.0856 12.6474 17.3459L8.74222 21.2512C8.65822 21.3351 8.5146 21.2757 8.5146 21.1569L8.51461 18.0469C8.51461 17.6787 8.21613 17.3802 7.84794 17.3802H6.11461C5.74642 17.3802 5.44794 17.6787 5.44794 18.0469V26.0469C5.44794 26.4151 5.74711 26.7135 6.1153 26.7135Z"
                fill="currentColor"></path>
            </svg>
          </button>
        </div>

        <div id="player-loading" class="loading-container hidden" aria-live="polite">
          <div class="loading-spinner" aria-hidden="true"></div>
          <div class="mt-4">加载中...</div>
        </div>
        <div id="error" class="error-container" aria-live="assertive">
          <div class="error-icon" aria-hidden="true">⚠️</div>
          <div class="text-xl font-bold">播放出错</div>
          <div class="mt-2">请尝试其他线路或刷新页面</div>
          <button
            id="retry-button"
            class="mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors"
            >重试</button
          >
        </div>

        <div
          id="player-toast"
          class="fixed top-4 left-1/2 -translate-x-1/2 opacity-0 px-6 py-3 rounded-lg shadow-lg transform transition-all duration-300 text-white z-10001 pointer-events-none"
        >
          <span id="player-toastMessage"></span>
        </div>
      </div>

      <div class="flex items-center justify-between px-6 pt-6 pb-2">
        <button
          id="prev-episode"
          class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-5 py-3 text-white/90 hover:text-white flex items-center gap-3 transition-all duration-300 shadow-lg hover:shadow-xl font-medium"
          aria-label="上一集"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="feather feather-skip-back"
          >
            <polygon points="19 20 9 12 19 4 19 20"></polygon>
            <line x1="5" y1="19" x2="5" y2="5"></line>
          </svg>
          <span>上一集</span>
        </button>
        <span
          id="episode-info-span"
          class="text-xl font-semibold text-white/90 bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl px-4 py-2 hidden"
        ></span>
        <button
          id="next-episode"
          class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl px-5 py-3 text-white/90 hover:text-white flex items-center gap-3 transition-all duration-300 shadow-lg hover:shadow-xl font-medium"
          aria-label="下一集"
        >
          <span>下一集</span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="feather feather-skip-forward"
          >
            <polygon points="5 4 15 12 5 20 5 4"></polygon>
            <line x1="19" y1="5" x2="19" y2="19"></line>
          </svg>
        </button>
      </div>

      <div class="px-0 py-2 bg-transparent mx-6 mb-2">
        <div class="player-control-bar-wrapper">
          <div class="player-control-bar">
            <div class="control-btn-container play-settings-container">
              <button
                id="play-settings-button"
                title="播放设置"
                class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium"
                aria-label="播放设置"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="control-icon"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"
                  ></path>
                </svg>
                <span class="control-text text-sm">设置</span>
              </button>
              <div
                id="play-settings-dropdown"
                class="hidden absolute right-0 bottom-full mb-2 bg-white/5 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-56"
              >
                <div class="flex items-center justify-between mb-3">
                  <span class="text-xs text-white/70">自动连播</span>
                  <label class="switch">
                    <input type="checkbox" id="autoplay-next" checked aria-label="自动播放" />
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between mb-3">
                  <span class="text-xs text-white/70">记住进度</span>
                  <label class="switch">
                    <input
                      type="checkbox"
                      id="remember-episode-progress-toggle"
                      checked
                      aria-label="记住进度"
                    />
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between mb-3">
                  <span class="text-xs text-white/70">广告过滤</span>
                  <label class="switch">
                    <input type="checkbox" id="adFilterToggle" aria-label="分片 广告过滤" />
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="flex items-center justify-between mb-3">
                  <span class="text-xs text-white/70">预加载</span>
                  <div class="flex items-center gap-2">
                    <label class="switch">
                      <input type="checkbox" id="preloadingToggle" aria-label="播放预加载" />
                      <span class="slider"></span>
                    </label>
                    <input
                      type="number"
                      min="1"
                      max="10"
                      step="1"
                      id="preloadCountInput"
                      class="w-16 bg-black/40 border border-white/10 rounded-lg px-3 py-1 text-sm focus:border-indigo-500 transition-colors"
                      placeholder="1"
                    />
                  </div>
                </div>
                <div class="flex items-center justify-between">
                  <span class="text-xs text-white/70">播放速率</span>
                  <select
                    id="playback-speed-select"
                    class="bg-black/40 text-white/70 rounded-lg px-3 py-1 text-sm border border-white/10 focus:border-indigo-500 transition-colors"
                  >
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="control-btn-container line-switch-container">
              <button
                id="line-switch-button"
                title="切换线路"
                class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium"
                aria-label="切换线路"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="control-icon"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"
                  ></path>
                </svg>
                <span class="control-text text-sm">线路</span>
              </button>
              <div
                id="line-switch-dropdown"
                class="hidden absolute right-0 bottom-full mb-2 bg-white/5 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-56"
              >
              </div>
            </div>

            <div class="control-btn-container skip-control-container">
              <button
                id="skip-control-button"
                title="智能跳过"
                class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium"
                aria-label="智能跳过"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="control-icon"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                  <path
                    d="M12 2a10 10 0 1 0 10 10"
                    stroke-dasharray="4 4"
                  ></path>
                </svg>
                <span class="control-text text-sm">跳过</span>
              </button>
              <div
                id="skip-control-dropdown"
                class="hidden absolute right-0 bottom-full mb-2 bg-white/5 backdrop-blur-md border border-white/10 rounded-xl shadow-xl p-4 w-64"
              >
                <div class="text-sm font-bold mb-3 border-b border-white/10 pb-2">设置</div>
                <div class="space-y-4">
                  <div>
                    <label
                      class="block text-xs text-white/40 mb-1.5 uppercase tracking-tighter"
                      >跳过片头 (秒)</label
                    ><input
                      type="number"
                      id="skip-intro-input"
                      class="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 transition-colors"
                      placeholder="例如: 90"
                    />
                  </div>
                  <div>
                    <label
                      class="block text-xs text-white/40 mb-1.5 uppercase tracking-tighter"
                      >跳过片尾 (秒)</label
                    ><input
                      type="number"
                      id="skip-outro-input"
                      class="w-full bg-black/40 border border-white/10 rounded-lg px-3 py-2 text-sm focus:border-indigo-500 transition-colors"
                      placeholder="例如: 120"
                    />
                  </div>
                  <div class="grid grid-cols-2 gap-3 pt-2">
                    <button
                      id="apply-skip-settings"
                      class="bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold h-10 rounded-xl transition-all shadow-lg active:scale-95"
                      >应用</button
                    >
                    <button
                      id="reset-skip-settings"
                      class="bg-white/5 hover:bg-white/10 text-white/60 text-xs font-bold h-10 rounded-xl transition-all"
                      >重置</button
                    >
                  </div>
                </div>
              </div>
            </div>

            <div class="control-btn-container">
              <button
                id="lock-button"
                title="锁定屏幕"
                class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium"
                aria-label="锁定屏幕"
              >
                <svg
                  id="lock-icon"
                  xmlns="http://www.w3.org/2000/svg"
                  class="control-icon"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                <span class="control-text text-sm">锁定</span>
              </button>
            </div>

            <div class="control-btn-container">
              <button
                onclick="copyLinks()"
                title="复制链接"
                class="control-btn bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 hover:border-white/40 rounded-xl p-3 text-white/90 hover:text-white transition-all duration-300 flex items-center gap-2 font-medium"
                aria-label="复制链接"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="control-icon"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                <span class="control-text text-sm">复制</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="px-6 py-4">
        <div id="episode-buttons-grid" class="grid grid-cols-3 xs:grid-cols-4 sm:grid-cols-6 md:grid-cols-8 gap-3">
        </div>
      </div>

      <div
        id="modal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md hidden items-center justify-center transition-all duration-300 z-10002 p-4"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalTitle"
        aria-hidden="true"
        tabindex="-1"
      >
        <div
          class="bg-[#1a1a2e]/90 backdrop-blur-2xl border border-white/10 rounded-3xl w-full max-w-4xl max-h-[90vh] flex flex-col shadow-[0_0_50px_rgba(0,0,0,0.5)] overflow-hidden"
        >
          <div class="flex justify-between items-center p-6 border-b border-white/10 flex-none">
            <h2 id="modalTitle" class="text-2xl md:text-3xl font-bold gradient-text truncate pr-4">
            </h2>
            <button
              id="closeModalButton"
              class="text-white/60 hover:text-white bg-white/10 hover:bg-white/20 rounded-2xl p-2.5 transition-all duration-300 shrink-0"
              aria-label="关闭详情"
              type="button"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
          <div class="overflow-auto flex-1 p-6">
            <div id="modalContent"></div>
          </div>
        </div>
      </div>

      <div
        id="progress-restore-modal"
        class="fixed inset-0 bg-black/75 backdrop-blur-sm hidden items-center justify-center transition-all duration-300 z-22002 p-4"
        role="dialog"
        aria-modal="true"
        aria-labelledby="progressRestoreTitle"
        aria-hidden="true"
        tabindex="-1"
      >
        <div class="progress-restore-card">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 bg-indigo-500/20 rounded-xl flex items-center justify-center">
              <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h3 id="progressRestoreTitle" class="text-lg font-bold">继续播放</h3>
          </div>
          <p id="progress-restore-message" class="text-sm text-white/70 mb-6"></p>
          <div class="flex gap-3">
            <button
              id="restore-progress-btn"
              class="flex-1 bg-indigo-600 hover:bg-indigo-500 text-white font-medium py-2.5 rounded-xl transition-all active:scale-95"
            >
              继续播放
            </button>
            <button
              id="skip-progress-btn"
              class="flex-1 bg-white/10 hover:bg-white/20 text-white/70 hover:text-white font-medium py-2.5 rounded-xl transition-all active:scale-95"
            >
              重新开始
            </button>
          </div>
        </div>
      </div>

      <div
        id="message"
        class="fixed top-4 right-4 p-4 rounded shadow-lg z-50 hidden"
        aria-live="polite"
      >
      </div>
    </div>

    <script is:inline src="/js/player_search_history.js" defer></script>
    <script type="module" src="/js/player_app.js"></script>
  </body>
</html>
